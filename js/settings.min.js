"use strict";function initializePlugins(){if($.fn.tabCollapse.Constructor.prototype.checkState=function(){$(".nav-tabs.hidden-xs").is(":visible")&&this._accordionVisible?(this.showTabs(),this._accordionVisible=!1):this.$accordion.is(":visible")&&!this._accordionVisible&&(this.showAccordion(),this._accordionVisible=!0)},$(".nav-tabs.visible-xs").tabCollapse(),location.hash){$("a[href='"+location.hash+"']").tab("show");$(".tab-content "+location.hash+" form").length&&$("nav.navbar .fa-save").fadeIn().attr("form","form_"+location.hash.replace("#",""));$("#settings .nav-tabs").find("a").on("shown.bs.tab",scrollToError)}else{scrollToError(0);var n=$("form:visible");$("nav.navbar .fa-save").fadeIn().attr("form",n.attr("id"))}}function setEventHandlers(){$(".nav-tabs.hidden-xs a").click(function(){var n=$(this).attr("href");location.hash=n});$(".nav-tabs.hidden-xs a").click(function(){setTimeout(setSaveButton,0)});$(".nav-tabs a").on("shown.bs.tab",setSaveButton);$(".fa-trash-alt").click(function(){return openConfirmDialog("Delete this item?",[{url:$(this).attr("href")}],function(){$(this).attr("id")==="confirm-yes"&&(window.location.href=$(this).closest("div").data("url"));$.fancybox.close()}),!1});$("#bgcolor").on("change",function(){$(this).val()=="timebg"?$(this).parents(".row").next().removeClass("hidden").next().removeClass("hidden"):$(this).parents(".row").next().addClass("hidden").next().addClass("hidden")});$(".location").next().on("click",function(){var n=$(this);navigator.geolocation.getCurrentPosition(function(t){var i=n.prev();i.hasClass("latitude")?i.val(t.coords.latitude):i.hasClass("longitude")&&i.val(t.coords.longitude)})});$(".refresh-api").on("click",function(){return setSelectData($(this).parents(".input-group").find("select")),!1});$(".webauth").on("click",function(){var n=$.trim($(this).parents("tr").find(".id").html());return $.getJSON("webauthchallenge/"+n,function(t){webauthnRegister(t,function(t,i){t?$.ajax({url:"webauthregister",method:"POST",data:{userid:n,registrationdata:i},success:function(n){n?showAlert("success","Authentication added"):showAlert("danger","Authentication failed to add")},error:function(){showAlert("danger","Authentication failed to add")}}):showAlert("danger","Authentication failed to add")})}),!1})}function setSelectData(n){if(n.length){var t=n.data("selected").split(",");n.find("option").remove();n.attr("disabled",!0);n.selectpicker("refresh");$.ajax({url:n.data("apiurl"),dataType:"json",success:function(i){$.each(i,function(i,r){n.append("<option value='"+i+"' "+(t.indexOf(i)!==-1?"selected":"")+">"+r+"<\/option>")});n.attr("disabled",!1);n.selectpicker("refresh")}})}}function toggleFieldsInFieldSet(n){var t=n.closest("fieldset").find(".form-group");n.prop("checked")?t.removeClass("hidden"):t.addClass("hidden")}function scrollToError(){var n=$("#settings").data("scrollto");n&&setTimeout(function(){$([document.documentElement,document.body]).animate({scrollTop:$("input[name='"+n+"']").offset().top-60})},0)}function setSaveButton(){var n=$("form:visible"),t=$("nav.navbar .fa-save");n.length?t.fadeIn().attr("form",n.attr("id")):t.fadeOut()}function webauthnRegister(n,t){n=JSON.parse(n);n.publicKey.attestation=undefined;n.publicKey.challenge=new Uint8Array(n.publicKey.challenge);n.publicKey.user.id=new Uint8Array(n.publicKey.user.id);navigator.credentials.create({publicKey:n.publicKey}).then(function(i){var r=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(i.response.clientDataJSON))),u,f,e;if(n.b64challenge!=r.challenge&&t(!1,"key returned something unexpected (1)"),"https://"+n.publicKey.rp.name!=r.origin)return t(!1,"key returned something unexpected (2)");if(!("type"in r))return t(!1,"key returned something unexpected (3)");if(r.type!="webauthn.create")return t(!1,"key returned something unexpected (4)");u=[];new Uint8Array(i.response.attestationObject).forEach(function(n){u.push(n)});f=[];new Uint8Array(i.rawId).forEach(function(n){f.push(n)});e={rawId:f,id:i.id,type:i.type,response:{attestationObject:u,clientDataJSON:JSON.parse(String.fromCharCode.apply(null,new Uint8Array(i.response.clientDataJSON)))}};t(!0,JSON.stringify(e))}).catch(function(n){"name"in n&&(n.name=="AbortError"||n.name=="NS_ERROR_ABORT")||n.name=="NotAllowedError"?t(!1,"abort"):t(!1,n.toString())})}$(function(){initializePlugins();setEventHandlers();setSelectData($("select[name='pulseway-systems[]']"));setSelectData($("select[name='jellyfin-views[]']"));$("legend input[type='checkbox']").each(function(){toggleFieldsInFieldSet($(this));$(this).change(function(){toggleFieldsInFieldSet($(this))})});$("#settings").fadeIn("fast")});