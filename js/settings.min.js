/*! chell-php-portal v1.4.0 | (c) 2021 Jos Nienhuis | GPL-2.0 License */
function initializePlugins(){var t;$.fn.tabCollapse.Constructor.prototype.checkState=function(){$(".nav-tabs.hidden-xs").is(":visible")&&this._accordionVisible?(this.showTabs(),this._accordionVisible=!1):this.$accordion.is(":visible")&&!this._accordionVisible&&(this.showAccordion(),this._accordionVisible=!0)},$(".nav-tabs.visible-xs").tabCollapse(),location.hash?($("a[href='"+location.hash+"']").tab("show"),$(".tab-content "+location.hash+" form").length&&$("nav.navbar .fa-save").fadeIn().attr("form","form_"+location.hash.replace("#","")),$("#settings .nav-tabs").find("a").on("shown.bs.tab",scrollToError)):(scrollToError(0),t=$("form:visible"),$("nav.navbar .fa-save").fadeIn().attr("form",t.attr("id")))}function setEventHandlers(){$(".nav-tabs.hidden-xs a").click(function(){var t=$(this).attr("href");location.hash=t}),$(".nav-tabs.hidden-xs a").click(function(){setTimeout(setSaveButton,0)}),$(".nav-tabs a").on("shown.bs.tab",setSaveButton),$(".fa-trash-alt").click(function(){return openConfirmDialog("Delete this item?",[{url:$(this).attr("href")}],function(){"confirm-yes"===$(this).attr("id")&&(window.location.href=$(this).closest("div").data("url")),$.fancybox.close()}),!1}),$("#bgcolor").on("change",function(){"timebg"==$(this).val()?$(this).parents(".row").next().removeClass("hidden").next().removeClass("hidden"):$(this).parents(".row").next().addClass("hidden").next().addClass("hidden")}),$(".location").next().on("click",function(){var n=$(this);navigator.geolocation.getCurrentPosition(function(t){var e=n.prev();e.hasClass("latitude")?e.val(t.coords.latitude):e.hasClass("longitude")&&e.val(t.coords.longitude)})}),$(".refresh-api").on("click",function(){return setSelectData($(this).parents(".input-group").find("select")),!1}),$(".webauth").on("click",function(){var n=$.trim($(this).parents("tr").find(".id").html());return $.getJSON("webauthchallenge/"+n,function(t){webauthnRegister(t,function(t,e){t?$.ajax({url:"webauthregister",method:"POST",data:{userid:n,registrationdata:e},success:function(t){t?showAlert("success","Authentication added"):showAlert("danger","Authentication failed to add")},error:function(){showAlert("danger","Authentication failed to add")}}):showAlert("danger","Authentication failed to add")})}),!1})}function setSelectData(n){var a;n.length&&(a=n.data("selected").split(","),n.find("option").remove(),n.attr("disabled",!0),n.selectpicker("refresh"),$.ajax({url:n.data("apiurl"),dataType:"json",success:function(t){$.each(t,function(t,e){n.append("<option value='"+t+"' "+(-1!==a.indexOf(t)?"selected":"")+">"+e+"</option>")}),n.attr("disabled",!1),n.selectpicker("refresh")}}))}function toggleFieldsInFieldSet(t){var e=t.closest("fieldset").find(".form-group");t.prop("checked")?e.removeClass("hidden"):e.addClass("hidden")}function scrollToError(){var t=$("#settings").data("scrollto");t&&setTimeout(function(){$([document.documentElement,document.body]).animate({scrollTop:$("input[name='"+t+"']").offset().top-60})},0)}function setSaveButton(){var t=$("form:visible"),e=$("nav.navbar .fa-save");t.length?e.fadeIn().attr("form",t.attr("id")):e.fadeOut()}$(function(){initializePlugins(),setEventHandlers(),setSelectData($("select[name='pulseway-systems[]']")),setSelectData($("select[name='jellyfin-views[]']")),$("legend input[type='checkbox']").each(function(){toggleFieldsInFieldSet($(this)),$(this).change(function(){toggleFieldsInFieldSet($(this))})}),$("#settings").fadeIn("fast")});;function webauthnRegister(a,i){(a=JSON.parse(a)).publicKey.attestation=void 0,a.publicKey.challenge=new Uint8Array(a.publicKey.challenge),a.publicKey.user.id=new Uint8Array(a.publicKey.user.id),navigator.credentials.create({publicKey:a.publicKey}).then(function(e){var n=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e.response.clientDataJSON)));if(a.b64challenge!=n.challenge&&i(!1,"key returned something unexpected (1)"),"https://"+a.publicKey.rp.name!=n.origin)return i(!1,"key returned something unexpected (2)");if(!("type"in n))return i(!1,"key returned something unexpected (3)");if("webauthn.create"!=n.type)return i(!1,"key returned something unexpected (4)");var t=[];new Uint8Array(e.response.attestationObject).forEach(function(e){t.push(e)});var r=[];new Uint8Array(e.rawId).forEach(function(e){r.push(e)});e={rawId:r,id:e.id,type:e.type,response:{attestationObject:t,clientDataJSON:JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e.response.clientDataJSON)))}};i(!0,JSON.stringify(e))}).catch(function(e){"name"in e&&("AbortError"==e.name||"NS_ERROR_ABORT"==e.name)||"NotAllowedError"==e.name?i(!1,"abort"):i(!1,e.toString())})}