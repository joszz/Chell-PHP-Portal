/*! chell-php-portal v1.4.0 | (c) 2021 Jos Nienhuis | GPL-2.0 License */
function webauthAuthCallback(t,a){t&&($("input[name=webauth]").val(a),$("form").attr("action","/portal/session/webauthauthenticate").submit())}$(function(){var t=!1;$("#webauth").on("click",function(){$("#password-group, #rememberme-wrapper").toggle(),t=!t}),$("#duo_iframe").length&&($(window).on("beforeunload",function(t){$("body").isLoading()}),$("#duo_iframe").on("load",function(){$(this).fadeIn()})),$("button[type=submit]").on("click",function(){if(t)return $.ajax({type:"POST",url:"/portal/session/webauthchallenge",data:{username:$("#username").val()},dataType:"json",success:function(t){webauthnAuthenticate(t,webauthAuthCallback)}}),!1})});;function webauthnAuthenticate(n,o){var r=JSON.parse(n),c=r.challenge;r.challenge=new Uint8Array(r.challenge),r.allowCredentials.forEach(function(n,a){r.allowCredentials[a].id=new Uint8Array(n.id)}),navigator.credentials.get({publicKey:r}).then(function(n){var a=[];new Uint8Array(n.rawId).forEach(function(n){a.push(n)});var r=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(n.response.clientDataJSON))),e=[];new Uint8Array(n.response.clientDataJSON).forEach(function(n){e.push(n)});var t=[];new Uint8Array(n.response.authenticatorData).forEach(function(n){t.push(n)});var i=[];new Uint8Array(n.response.signature).forEach(function(n){i.push(n)});r={type:n.type,originalChallenge:c,rawId:a,response:{authenticatorData:t,clientData:r,clientDataJSONarray:e,signature:i}};o(!0,JSON.stringify(r))}).catch(function(n){"name"in n&&("AbortError"==n.name||"NS_ERROR_ABORT"==n.name||"NotAllowedError"==n.name)?o(!1,"abort"):o(!1,n.toString())})}