"use strict";function toggleFieldsInFieldSet(n){var t=n.closest("fieldset").find(".form-group");n.prop("checked")?t.removeClass("hidden"):t.addClass("hidden")}function webauthnRegister(n,t){n=JSON.parse(n);n.publicKey.attestation=undefined;n.publicKey.challenge=new Uint8Array(n.publicKey.challenge);n.publicKey.user.id=new Uint8Array(n.publicKey.user.id);navigator.credentials.create({publicKey:n.publicKey}).then(function(i){var r=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(i.response.clientDataJSON))),u,f,e;if(n.b64challenge!=r.challenge&&t(!1,"key returned something unexpected (1)"),"https://"+n.publicKey.rp.name!=r.origin)return t(!1,"key returned something unexpected (2)");if(!("type"in r))return t(!1,"key returned something unexpected (3)");if(r.type!="webauthn.create")return t(!1,"key returned something unexpected (4)");u=[];new Uint8Array(i.response.attestationObject).forEach(function(n){u.push(n)});f=[];new Uint8Array(i.rawId).forEach(function(n){f.push(n)});e={rawId:f,id:i.id,type:i.type,response:{attestationObject:u,clientDataJSON:JSON.parse(String.fromCharCode.apply(null,new Uint8Array(i.response.clientDataJSON)))}};t(!0,JSON.stringify(e))}).catch(function(n){"name"in n&&(n.name=="AbortError"||n.name=="NS_ERROR_ABORT")||n.name=="NotAllowedError"?t(!1,"abort"):t(!1,n.toString())})}$(function(){$(".nav-tabs.visible-xs").tabCollapse();location.hash&&$("a[href='"+location.hash+"']").tab("show");$(".nav-tabs a").click(function(){location.hash=$(this).attr("href")});$(".fa-trash-alt").click(function(){return openConfirmDialog("Delete this item?",[{url:$(this).attr("href")}],function(){$(this).attr("id")==="confirm-yes"&&(window.location.href=$(this).closest("div").data("url"));$.fancybox.close()}),!1});$("#bgcolor").on("change",function(){$(this).val()=="timebg"?$(this).parents(".row").next().removeClass("hidden").next().removeClass("hidden"):$(this).parents(".row").next().addClass("hidden").next().addClass("hidden")});$("input[type='number'][step!='any']").TouchSpin({verticalupclass:"fa fa-chevron-left",verticaldownclass:"fa fa-chevron-right",buttondown_class:"btn btn-default",buttonup_class:"btn btn-default",max:1e3});$("legend input[type='checkbox']").each(function(){toggleFieldsInFieldSet($(this));$(this).change(function(){toggleFieldsInFieldSet($(this))})});$("#settings").fadeIn("fast");$(".webauth").on("click",function(){var n=$.trim($(this).parents("tr").find(".id").html());return $.getJSON("webauthchallenge/"+n,function(t){webauthnRegister(t,function(t,i){t?$.ajax({url:"webauthregister",method:"POST",data:{userid:n,registrationdata:i},success:function(n){n?showAlert("success","Authentication added"):showAlert("danger","Authentication failed to add")},error:function(){showAlert("danger","Authentication failed to add")}}):showAlert("danger","Authentication failed to add")})}),!1})});